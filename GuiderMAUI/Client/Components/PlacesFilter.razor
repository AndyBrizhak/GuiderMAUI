@using GuiderMAUI.Shared.Models
@inject NavigationManager Navigation

<div class="filter-card">
    @* Подключаем наш новый компонент *@
    <FilterTextSearch InitialValue="@CurrentFilters.Q" 
                      OnSearch="HandleSearch" />
</div>

@code {
    [Parameter] public PlaceFilterParams CurrentFilters { get; set; } = new();

    // Этот метод вызывается, когда FilterTextSearch нажимает "Поиск" или "Очистить"
    private void HandleSearch(string? newSearchTerm)
    {
        var queryParams = new Dictionary<string, object?>();

        // 1. Используем НОВОЕ значение поиска
        if (!string.IsNullOrWhiteSpace(newSearchTerm))
        {
            queryParams["Q"] = newSearchTerm;
        }
        else
        {
            queryParams["Q"] = null; // Удаляем параметр Q
        }

        // 2. Сохраняем остальные фильтры
        if (!string.IsNullOrEmpty(CurrentFilters.Category)) queryParams["Category"] = CurrentFilters.Category;
        if (!string.IsNullOrEmpty(CurrentFilters.Province)) queryParams["Province"] = CurrentFilters.Province;
        if (!string.IsNullOrEmpty(CurrentFilters.City)) queryParams["City"] = CurrentFilters.City;

        // 3. Сбрасываем пагинацию
        queryParams["Page"] = 1;
        if (CurrentFilters.PerPage > 0) queryParams["PerPage"] = CurrentFilters.PerPage;

        // 4. Навигация
        var uri = Navigation.GetUriWithQueryParameters(queryParams);
        Navigation.NavigateTo(uri);
    }
}