@using GuiderMAUI.Shared.Models
@inject NavigationManager Navigation

<div class="places-list-container">

    <PlacesFilter CurrentFilters="CurrentFilters" />

    @if (IsLoading)
    {
        <div class="loading" style="text-align:center; padding: 2rem;">
            <p>Loading places...</p>
        </div>
    }
    else if (PlacesResponse?.Places != null && PlacesResponse.Places.Any())
    {
        <div class="places-grid">
            @foreach (var place in PlacesResponse.Places)
            {
                <PlaceCard Place="@place" />
            }
        </div>

        @* ---  СЕКЦИЯ: ПАГИНАЦИЯ --- *@
        <div class="pagination-controls">
            @* Кнопка НАЗАД *@
            <button class="btn-page"
                    disabled="@(PlacesResponse.Page <= 1)"
                    @onclick="GoToPrevPage"
                    aria-label="Previous page">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
                </svg>
            </button>

            @* Информация о страницах *@
            <span class="pagination-info">
                Page @PlacesResponse.Page of @PlacesResponse.TotalPages
            </span>

            @* Кнопка ВПЕРЕД *@
            <button class="btn-page"
                    disabled="@(PlacesResponse.Page >= PlacesResponse.TotalPages)"
                    @onclick="GoToNextPage"
                    aria-label="Next page">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
                </svg>
            </button>
        </div>
    }
    else
    {
        <div class="no-results" style="text-align:center; padding: 2rem;">
            <p>No places found.</p>
        </div>
    }
</div>

@code {
    [Parameter] public PlaceFilterParams CurrentFilters { get; set; } = new();
    [Parameter] public PlacesResponse? PlacesResponse { get; set; }
    [Parameter] public bool IsLoading { get; set; }

    // Логика перехода на предыдущую страницу
    private void GoToPrevPage()
    {
        if (PlacesResponse != null && PlacesResponse.Page > 1)
        {
            var newPage = PlacesResponse.Page - 1;
            ChangePage(newPage);
        }
    }

    // Логика перехода на следующую страницу
    private void GoToNextPage()
    {
        if (PlacesResponse != null && PlacesResponse.Page < PlacesResponse.TotalPages)
        {
            var newPage = PlacesResponse.Page + 1;
            ChangePage(newPage);
        }
    }

    // Метод обновляет URL, сохраняя остальные параметры поиска
    private void ChangePage(int newPage)
    {
        // В .NET 8 это самый надежный способ обновить один параметр
        var uri = Navigation.GetUriWithQueryParameter("Page", newPage);
        Navigation.NavigateTo(uri);
    }
}