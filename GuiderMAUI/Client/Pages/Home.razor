@page "/"
@using GuiderMAUI.Shared.Models
@using GuiderMAUI.Shared.Services
@using GuiderMAUI.Client.Components

@inject IPlacesService PlacesService
@inject NavigationManager Navigation

<div class="home-page">
    <div class="hero-section">
        <h1>Explore Local Businesses</h1>
    </div>

    <PlacesList CurrentFilters="@currentFilters"
                PlacesResponse="@placesResponse"
                IsLoading="@isLoading" />
</div>

@code {
    [SupplyParameterFromQuery] public string? Q { get; set; }
    [SupplyParameterFromQuery] public string? Category { get; set; }
    [SupplyParameterFromQuery] public string? Province { get; set; }
    [SupplyParameterFromQuery] public string? City { get; set; }
    [SupplyParameterFromQuery] public int Page { get; set; } = 1;
    [SupplyParameterFromQuery] public bool? IsOpen { get; set; } 

    private PlaceFilterParams currentFilters = new();
    private PlacesResponse? placesResponse;
    private bool isLoading = true;

    protected override async Task OnParametersSetAsync()
    {
        isLoading = true;

        currentFilters = new PlaceFilterParams
        {
            Q = Q,
            Category = Category,
            Province = Province,
            City = City,
            Page = Page < 1 ? 1 : Page,
            PerPage = 4,
            Status = "active",
            IsOpen = IsOpen 
        };

        try
        {
            placesResponse = await PlacesService.GetPlacesAsync(currentFilters);
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Home Load Error: {ex.Message}");
        }
        finally
        {
            isLoading = false;
        }
    }
}